# YouTube-dual-subtitles

<!-- https://www.youtube.com/api/timedtext?type=list&v=ZXmKKV7R72c -->

<!-- "matches": ["http://127.0.0.1/*"], -->

https://www.youtube.com/watch?v=JMaxUBPUwcQ

JSON.parse(ytplayer.config.args.player_response).captions.playerCaptionsTracklistRenderer.translationLanguages

let data = chrome.i18n.getUILanguage();
watch?v=

window.addEventListener(
'mousedown',
() => {
console.log('Ëß¶ÂèëËØ∑Ê±Ç');
},
{ once: true }
);
"all_frames": true,
"persistent": true

<div class="ytp-menuitem" tabindex="0" role="menuitemradio" data-lang="${autoLang.languageCode[0]}" aria-checked="true">
  <div class="ytp-menuitem-label">Auto</div>
</div>

page_action
browser_action
"icons": {},
"matches": ["https://www.youtube.com/watch?v=*"],

https://www.youtube-nocookie.com/embed/vsMJiNtQWvw"

https://www.youtube.com/embed/vsMJiNtQWvw

<!-- \nÂ∑≤ÂºÄÂêØ üëç -->

ytInitialPlayerResponse.captions.playerCaptionsTracklistRenderer.translationLanguages
var e=this.H.getOption("captions","translationLanguages");

// console.log('ytplayer', ytplayer);
// const autoTranslationList = JSON.parse(ytplayer.config.args.player_response).captions.playerCaptionsTracklistRenderer.translationLanguages;

window.ytInitialPlayerResponse.captions.playerCaptionsTracklistRenderer.translationLanguages

document.querySelector('.html5-video-player').getOption('captions', 'translationLanguages')

// injection2(`// document.addEventListener('DOMContentLoaded', () => console.log('iframe: DOMContentLoaded')); //`);

// injection2(`XMLHttpRequest.prototype.open = proxiedOpen; XMLHttpRequest.prototype.send = proxiedSend;`);
// insertCustomMenu({ langArg, singleStatus })();
// mainCode(restartSubtitles);

// document.querySelector('.html5-video-player video').addEventListener('canplay', () => {
// console.log('canplay');
// injection2(`// const autoTranslationList_ = document // .querySelector('.html5-video-player') // .getOption('captions', 'translationLanguages'); // console.log(333, autoTranslationList_); // localStorage.setItem('autoTranslationList', JSON.stringify(autoTranslationList_)); //`);
// const autoTranslationList = JSON.parse(localStorage.getItem('autoTranslationList'));
// console.log('autoTranslationList: ', autoTranslationList);
// });

// document.querySelector('.ytp-settings-button').addEventListener('click', () => {
// injection2(`// console.log('data-2: ', document.querySelector('.html5-video-player').getOption('captions', 'translationLanguages')); //`);
// });

// if (window.self === window.top) {
// injection2(`// try { // localStorage.setItem( // 'autoTranslationList', // JSON.stringify(ytInitialPlayerResponse.captions.playerCaptionsTracklistRenderer.translationLanguages) // ); // } catch { // console.log('Êâæ‰∏çÂà∞Â≠óÂπï'); // } //`);
// } else {
// // localStorage.setItem('autoTranslationList', JSON.stringify(autoTranslationList\_));
// console.log('iframe ‰∏≠!!');
// }

// const autoTranslationList = JSON.parse(localStorage.getItem('autoTranslationList')) || autoTranslationList\_;
// console.log('autoTranslationList: ', autoTranslationList);
// \${languageName}

// const languageUsed = autoTranslationList.find(v => v.languageCode === langArg[0]);
// const languageName = languageUsed ? languageUsed.languageName.simpleText : '';

// console.log('rule1', rule1);

// const autoTranslationList = player.getOption('captions', 'translationLanguages');
// chrome.storage.local.set({ autoTranslationList\_: autoTranslationList });

//

// autoTranslationList\_

// player = document.querySelector('.html5-video-player');
// player.getOption("captions", "translationLanguages");

// player.getOption("captions", "track");
// player.getOption("captions", "tracklist");

// getOption("captions", "translationLanguages")

// selectLangCode, autoLangCode,
// const langArg = selectLangCode || autoLangCode;

/_ if (autoLangCode) {
document.addEventListener('DOMContentLoaded', () => {
injection2(`localStorage.setItem( 'autoTranslationList', JSON.stringify(window.ytInitialPlayerResponse.captions.playerCaptionsTracklistRenderer.translationLanguages) );`);
});
} _/

// if (!autoTranslationList*.length && autoTranslationList) {
// chrome.storage.local.set({ autoTranslationList*: autoTranslationList });
// console.log('ËÆæÁΩÆ autoTranslationList\_');
// }

// const langArg = selectLangCode || autoLangCode; autoLangCode, selectLangCode,
// console.log('autoLangCode: ', autoLangCode);
// console.log('selectLangCode: ', selectLangCode);

// localStorage.setItem('selectLangCode', JSON.stringify(selectLangCode));
// localStorage.setItem('autoLangCode', JSON.stringify(autoLangCode));

// if (autoLang) chrome.storage.local.set({ autoLangCode: autoLang.languageCode }); autoLangCode,

// Áõ¥Êé•ËøîÂõû arg ËÄå‰∏çÊòØ‰∏§ËÄÖ
// Áõ¥Êé•ÂêåÊ≠•ÊØîËæÉ,ËÄå‰∏çÊòØ set ÂÜç get

// console.log('UILang: ', UILang);
// console.log('autoLang: ', autoLang);

// reboot && reboot();

// document.addEventListener('DOMContentLoaded', () => console.log('DOMContentLoaded!!'));

// document.addEventListener('DOMContentLoaded', () => insertCustomMenu());
// chrome.storage.local.get('status', ({ status }) => {
// if (status) document.addEventListener('DOMContentLoaded', () => insertCustomMenu());
// });

// ytp-panel-animate-back ytp-panel-animate-forward (100%)

// window.addEventListener('click', () => {
// console.log('windwos:click');
// });

// const levelWidth = ytpSettingsMenu.style.getPropertyValue('width');
// const autoTranslationList = JSON.parse(localStorage.getItem('autoTranslationList'));
// const langArg = JSON.parse(localStorage.getItem('selectLangCode')) || autoLang.languageCode;

// ÊØè‰∏™Á™óÂè£ÂêåÊ≠•Áä∂ÊÄÅ
// window.addEventListener('focus', () => {
// chrome.storage.local.get('single', ({ single }) => {
// document.querySelector('#single-button').setAttribute('aria-checked', single);
// });
// });

// chrome.storage.local.get(
// ['single', 'selectLangCode', 'autoLangCode', 'autoTranslationList_'],
// ({ single, selectLangCode, autoLangCode, autoTranslationList\_ }) => {
// });

// const autoTranslationList = JSON.parse(ytplayer.config.args.player_response).captions.playerCaptionsTracklistRenderer
// .translationLanguages;

// XMLHttpRequest.prototype.open = proxiedOpen;
// XMLHttpRequest.prototype.send = proxiedSend;
// console.log('ytplayer', ytplayer);

// const selectLangCode = JSON.parse(localStorage.getItem('selectLangCode'));
// const autoLangCode = JSON.parse(localStorage.getItem('autoLangCode'));
// const languageParameter = selectLangCode || autoLangCode;
// console.log({ selectLangCode, autoLangCode, languageParameter });

// return;

// langList.forEach(async (value, key) => {
// lastTime += 300;
// setTimeout(() => {
// translate
// .translate(loca2, { to: key })
// .then(([translation]) => {
// const obj = {};
// obj.name = { message: translation[0] };
// obj.description = { message: translation[1] };
// obj.singleSubtitle = { message: translation[2] };
// obj.defaultSubtitles = { message: translation[3] };
// obj.auto = { message: translation[4] };
// obj.feedback = { message: translation[5] };
// obj.learnMore = { message: translation[6] };

// const createFolder = `./_locales/${key.replace('-', '_')}`;
// fs.mkdirSync(createFolder);
// fs.writeFile(`${createFolder}/messages.json`, JSON.stringify(obj, null, ' '), console.log);
// })
// .catch(error => {
// fs.appendFile('./log.md', `${error} => ${key}\n\n`, () => console.log('error:', key));
// });
// }, lastTime);
// });

/\_ const loca = [
['name', 'YouTube dual subtitles'],
['description', 'YouTube dual subtitles and automatic switching to local language.'],
['singleSubtitle', 'Single subtitle'],
['defaultSubtitles', 'Default subtitles'],
['auto', 'Auto'],
['feedback', 'Feedback'],
['learnMore', 'Learn More'],
];

// const track = document.querySelector('.html5-video-player').getOption('captions', 'track');

// chrome.i18n.getMessage('popup_reportIssues'),
// chrome.pageAction.setTitle({ tabId, title });
// chrome.pageAction.setTitle({ tabId, title: 'YouTube ÂèåÂ≠óÂπï\n Â∑≤ÂÖ≥Èó≠ ‚ö°' });

# Êã¶Êà™ËØ∑Ê±Ç

```
/* await fetch(`https://www.youtube.com/api/timedtext?type=list&v=${v}`)
.then(response => response.text())
.then(str => new window.DOMParser().parseFromString(str, 'text/xml'))
.then(data => {
const list = [...data.querySelectorAll('track')].map(v => ({
name: v.getAttribute('name'),
lang_code: v.getAttribute('lang_code'),
}));
const result = list.find(v => languageCode.includes(v.lang_code));
});
*/
// result.name ? u.searchParams.set('name', result.name) : u.searchParams.delete('name');
// u.searchParams.set('lang', result.lang_code);
// return fetch(u.toString()).then(res => res.json());

// let original = {};
// let local = {};
// const v = u.searchParams.get('v');

```
